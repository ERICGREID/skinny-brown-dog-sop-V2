<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skinny Brown Dog Media - Publishing Workflow Tracker</title>
    <style>
        :root {
            --primary: #1a56db;
            --primary-dark: #1e429f;
            --secondary: #64748b;
            --accent: #3b82f6;
            --light: #f3f4f6;
            --white: #ffffff;
            --gray-100: #f9fafb;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--gray-100);
            color: var(--gray-700);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--white);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 40px;
            border-radius: 8px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-200);
        }

        header img {
            max-width: 300px;
            margin-bottom: 20px;
        }

        h1 {
            color: var(--primary);
            font-size: 28px;
            margin-bottom: 10px;
        }

        h2 {
            color: var(--primary);
            margin: 30px 0 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--accent);
            font-size: 20px;
        }

        h3 {
            color: var(--secondary);
            margin: 20px 0 10px;
            font-size: 18px;
        }

        .project-info {
            background-color: var(--light);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .project-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .info-item {
            margin-bottom: 15px;
        }

        .info-item label {
            display: block;
            font-weight: bold;
            color: var(--secondary);
            margin-bottom: 5px;
        }

        .info-item input[type="text"],
        .info-item input[type="date"],
        .info-item input[type="password"],
        .info-item textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--gray-300);
            border-radius: 4px;
            font-family: inherit;
        }

        .info-item input[type="password"] {
            font-family: 'password';
            letter-spacing: 2px;
        }

        .phase-container {
            margin-bottom: 40px;
            border: 1px solid var(--gray-300);
            border-radius: 8px;
            overflow: hidden;
        }

        .phase-header {
            background-color: var(--primary);
            color: var(--white);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .phase-header h2 {
            margin: 0;
            padding: 0;
            border: none;
            color: var(--white);
        }

        .phase-header .status {
            font-size: 14px;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 20px;
            background-color: var(--white);
        }

        .status-not-started {
            color: var(--gray-600);
        }

        .status-in-progress {
            color: var(--accent);
        }

        .status-completed {
            color: var(--success);
        }

        .phase-content {
            padding: 20px;
            background-color: var(--white);
        }

        .phase-container.collapsed .phase-content {
            display: none;
        }

        .phase-header:after {
            content: "â–¼";
            font-size: 12px;
            transition: transform 0.3s;
        }

        .phase-container.collapsed .phase-header:after {
            transform: rotate(-90deg);
        }

        .task-list {
            list-style-type: none;
        }

        .task-item {
            padding: 12px;
            margin-bottom: 10px;
            border: 1px solid var(--gray-200);
            border-radius: 4px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
        }

        .task-item:hover {
            background-color: var(--gray-100);
        }

        .task-item input[type="checkbox"] {
            margin-right: 10px;
            width: 20px;
            height: 20px;
        }

        .task-item.completed {
            background-color: var(--light);
            border-color: var(--success);
        }

        .task-item.completed label {
            text-decoration: line-through;
            color: var(--gray-500);
        }

        /* NEW STYLES FOR DUE DATES */
        .due-date {
            font-size: 0.9em;
            color: var(--gray-600);
            margin-left: 15px;
            font-style: italic;
        }

        .completion-date {
            font-size: 0.9em;
            color: var(--success);
            margin-left: 10px;
        }

        .date-controls {
            display: flex;
            gap: 10px;
            margin-top: 5px;
            width: 100%;
            margin-left: 30px;
        }

        .days-offset {
            width: 50px !important;
            padding: 3px !important;
            height: auto !important;
        }

        .actions {
            margin-top: 40px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: var(--primary-dark);
        }

        button.secondary {
            background-color: var(--gray-300);
            color: var(--gray-700);
        }

        button.secondary:hover {
            background-color: var(--gray-400);
        }

        button.success {
            background-color: var(--success);
        }

        button.warning {
            background-color: var(--warning);
        }

        @media (max-width: 768px) {
            .project-info-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 20px;
            }
            
            .task-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .date-controls {
                margin-left: 0;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <img src="https://via.placeholder.com/300x80?text=Skinny+Brown+Dog+Media" alt="Skinny Brown Dog Media Logo">
            <h1>Book Publishing Workflow Tracker</h1>
            <p>Comprehensive management system for book publication projects</p>
        </header>

        <div class="project-info">
            <h2>Book Project Information</h2>
            <div class="project-info-grid">
                <div class="info-item">
                    <label for="bookTitle">Book Title:</label>
                    <input type="text" id="bookTitle" name="bookTitle" required>
                </div>
                <div class="info-item">
                    <label for="authorName">Author Name:</label>
                    <input type="text" id="authorName" name="authorName" required>
                </div>
                <div class="info-item">
                    <label for="startDate">Project Start Date:</label>
                    <input type="date" id="startDate" name="startDate" required>
                </div>
                <div class="info-item">
                    <label for="pubDate">Target Publication Date:</label>
                    <input type="date" id="pubDate" name="pubDate" required>
                </div>
                <div class="info-item">
                    <label for="projectManager">Project Manager:</label>
                    <input type="text" id="projectManager" name="projectManager" required>
                </div>
            </div>
        </div>

        <!-- Pre-Manuscript Phase -->
        <div class="phase-container" id="phase1Container">
            <div class="phase-header" onclick="togglePhase('phase1Container')">
                <h2>Pre-Manuscript Phase</h2>
                <span class="status status-not-started" id="phase1Status">Not Started</span>
            </div>
            <div class="phase-content">
                <h3>Tasks</h3>
                <ul class="task-list">
                    <li class="task-item">
                        <input type="checkbox" id="task1" name="task1">
                        <label for="task1">Schedule discovery/lead follow-up call</label>
                        <span class="due-date"></span>
                        <span class="completion-date"></span>
                        <div class="date-controls">
                            <small>Days after start: <input type="number" class="days-offset" value="2" min="0"></small>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="task2" name="task2">
                        <label for="task2">Send welcome package with publishing agreement</label>
                        <span class="due-date"></span>
                        <span class="completion-date"></span>
                        <div class="date-controls">
                            <small>Days after start: <input type="number" class="days-offset" value="3" min="0"></small>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="task3" name="task3">
                        <label for="task3">Receive signed agreement</label>
                        <span class="due-date"></span>
                        <span class="completion-date"></span>
                        <div class="date-controls">
                            <small>Days after start: <input type="number" class="days-offset" value="7" min="0"></small>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="task4" name="task4">
                        <label for="task4">Receive FIRST PAYMENT (50%)</label>
                        <span class="due-date"></span>
                        <span class="completion-date"></span>
                        <div class="date-controls">
                            <small>Days after start: <input type="number" class="days-offset" value="1" min="0"></small>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="task5" name="task5">
                        <label for="task5">Create author folder in Google Drive</label>
                        <span class="due-date"></span>
                        <span class="completion-date"></span>
                        <div class="date-controls">
                            <small>Days after start: <input type="number" class="days-offset" value="2" min="0"></small>
                        </div>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Manuscript Development Phase -->
        <div class="phase-container" id="phase2Container">
            <div class="phase-header" onclick="togglePhase('phase2Container')">
                <h2>Manuscript Development Phase (3 Months)</h2>
                <span class="status status-not-started" id="phase2Status">Not Started</span>
            </div>
            <div class="phase-content">
                <h3>Tasks</h3>
                <ul class="task-list">
                    <li class="task-item">
                        <input type="checkbox" id="task6" name="task6">
                        <label for="task6">Receive draft manuscript or author notes</label>
                        <span class="due-date"></span>
                        <span class="completion-date"></span>
                        <div class="date-controls">
                            <small>Days after start: <input type="number" class="days-offset" value="14" min="0"></small>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="task7" name="task7">
                        <label for="task7">Complete developmental editing (~6 weeks)</label>
                        <span class="due-date"></span>
                        <span class="completion-date"></span>
                        <div class="date-controls">
                            <small>Days after start: <input type="number" class="days-offset" value="42" min="0"></small>
                        </div>
                    </li>
                    <li class="task-item">
                        <input type="checkbox" id="task8" name="task8">
                        <label for="task8">Author implements developmental editing feedback</label>
                        <span class="due-date"></span>
                        <span class="completion-date"></span>
                        <div class="date-controls">
                            <small>Days after start: <input type="number" class="days-offset" value="56" min="0"></small>
                        </div>
                    </li>
                </ul>
            </div>
        </div>

        <div class="actions">
            <button type="button" id="exportButton" class="success">Export Project</button>
            <button type="button" id="saveButton">Save Progress</button>
            <button type="button" id="printButton" class="secondary">Print Workflow</button>
        </div>
    </div>

    <script>
        // Task Configuration
        const defaultTaskOffsets = {
            task1: 2, task2: 3, task3: 7, task4: 1, task5: 2,
            task6: 14, task7: 42, task8: 56
        };
        
        let taskDueDateOffsets = {...defaultTaskOffsets};

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            loadOffsetsFromStorage();
            setupEventListeners();
            loadFormData();
        });

        function loadOffsetsFromStorage() {
            const savedOffsets = localStorage.getItem('taskDueDateOffsets');
            if (savedOffsets) {
                taskDueDateOffsets = {...defaultTaskOffsets, ...JSON.parse(savedOffsets)};
            }
            applyOffsetValuesToInputs();
        }

        function applyOffsetValuesToInputs() {
            document.querySelectorAll('.days-offset').forEach(input => {
                const taskId = input.closest('.task-item').querySelector('input[type="checkbox"]').id;
                input.value = taskDueDateOffsets[taskId] || 0;
            });
        }

        function setupEventListeners() {
            // Update due dates when start date changes
            document.getElementById('startDate').addEventListener('change', calculateAllDueDates);
            
            // Save offset changes
            document.querySelectorAll('.days-offset').forEach(input => {
                input.addEventListener('change', function() {
                    const taskId = this.closest('.task-item').querySelector('input[type="checkbox"]').id;
                    taskDueDateOffsets[taskId] = parseInt(this.value) || 0;
                    localStorage.setItem('taskDueDateOffsets', JSON.stringify(taskDueDateOffsets));
                    calculateAllDueDates();
                });
            });
            
            // Track completion dates
            document.querySelectorAll('.task-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const completionSpan = this.closest('.task-item').querySelector('.completion-date');
                    if (this.checked) {
                        completionSpan.textContent = `Completed: ${new Date().toLocaleDateString()}`;
                        this.dataset.completionDate = new Date().toISOString();
                    } else {
                        completionSpan.textContent = '';
                        delete this.dataset.completionDate;
                    }
                    updatePhaseStatus(this.closest('.phase-container').id);
                });
            });

            // Export button
            document.getElementById('exportButton').addEventListener('click', exportProject);
            
            // Save button
            document.getElementById('saveButton').addEventListener('click', saveCurrentProject);
            
            // Print button
            document.getElementById('printButton').addEventListener('click', function() {
                window.print();
            });
        }

        function calculateAllDueDates() {
            const startDate = new Date(document.getElementById('startDate').value);
            if (isNaN(startDate.getTime())) return;

            document.querySelectorAll('.task-item').forEach(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                const dueDateSpan = item.querySelector('.due-date');
                const daysOffset = taskDueDateOffsets[checkbox.id] || 0;
                
                const dueDate = new Date(startDate);
                dueDate.setDate(dueDate.getDate() + daysOffset);
                
                dueDateSpan.textContent = `Due: ${dueDate.toLocaleDateString()}`;
                checkbox.dataset.dueDate = dueDate.toISOString();
            });
        }

        function updatePhaseStatus(phaseContainerId) {
            const container = document.getElementById(phaseContainerId);
            const statusElement = container.querySelector('.status');
            const checkboxes = container.querySelectorAll('input[type="checkbox"]');
            
            let totalTasks = checkboxes.length;
            let completedTasks = 0;
            
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) completedTasks++;
            });
            
            if (completedTasks === 0) {
                statusElement.textContent = 'Not Started';
                statusElement.className = 'status status-not-started';
            } else if (completedTasks === totalTasks) {
                statusElement.textContent = 'Completed';
                statusElement.className = 'status status-completed';
            } else {
                const percentage = Math.round((completedTasks / totalTasks) * 100);
                statusElement.textContent = `In Progress (${percentage}%)`;
                statusElement.className = 'status status-in-progress';
            }
        }

        function getFormData() {
            const formData = {
                projectDetails: {
                    bookTitle: document.getElementById('bookTitle').value,
                    authorName: document.getElementById('authorName').value,
                    startDate: document.getElementById('startDate').value,
                    pubDate: document.getElementById('pubDate').value,
                    projectManager: document.getElementById('projectManager').value
                },
                taskDueDates: {}
            };

            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                formData.taskDueDates[checkbox.id] = {
                    dueDate: checkbox.dataset.dueDate,
                    completed: checkbox.checked,
                    completionDate: checkbox.dataset.completionDate || null,
                    daysOffset: taskDueDateOffsets[checkbox.id] || 0
                };
            });

            return formData;
        }

        function saveCurrentProject() {
            const formData = getFormData();
            
            // Validate required fields
            if (!formData.projectDetails.bookTitle || !formData.projectDetails.authorName || !formData.projectDetails.startDate) {
                alert('Please fill in all required fields (Book Title, Author Name, Start Date)');
                return;
            }
            
            // Save to localStorage
            localStorage.setItem('currentProject', JSON.stringify(formData));
            
            // Save to Google Drive (if connected)
            if (typeof gapi !== 'undefined' && gapi.client && gapi.client.drive) {
                saveToGoogleDrive(formData);
            }
            
            alert('Project saved successfully!');
        }

        function saveToGoogleDrive(formData) {
            // This is a placeholder - replace with your actual Google Drive integration
            console.log('Saving to Google Drive:', formData);
            // Implement your Google Drive API calls here
        }

        function loadFormData() {
            const savedData = localStorage.getItem('currentProject');
            if (savedData) {
                const formData = JSON.parse(savedData);
                
                // Load project details
                document.getElementById('bookTitle').value = formData.projectDetails.bookTitle || '';
                document.getElementById('authorName').value = formData.projectDetails.authorName || '';
                document.getElementById('startDate').value = formData.projectDetails.startDate || '';
                document.getElementById('pubDate').value = formData.projectDetails.pubDate || '';
                document.getElementById('projectManager').value = formData.projectDetails.projectManager || '';
                
                // Load task states
                for (const taskId in formData.taskDueDates) {
                    const taskData = formData.taskDueDates[taskId];
                    const checkbox = document.getElementById(taskId);
                    
                    if (checkbox) {
                        checkbox.checked = taskData.completed || false;
                        checkbox.dataset.dueDate = taskData.dueDate || '';
                        checkbox.dataset.completionDate = taskData.completionDate || '';
                        
                        // Update display
                        const dueDateSpan = checkbox.closest('.task-item').querySelector('.due-date');
                        const completionSpan = checkbox.closest('.task-item').querySelector('.completion-date');
                        
                        if (taskData.dueDate) {
                            dueDateSpan.textContent = `Due: ${new Date(taskData.dueDate).toLocaleDateString()}`;
                        }
                        
                        if (taskData.completed && taskData.completionDate) {
                            completionSpan.textContent = `Completed: ${new Date(taskData.completionDate).toLocaleDateString()}`;
                        }
                        
                        // Update task offsets
                        if (taskData.daysOffset !== undefined) {
                            taskDueDateOffsets[taskId] = taskData.daysOffset;
                        }
                    }
                }
                
                // Update all due dates
                calculateAllDueDates();
                
                // Update phase statuses
                document.querySelectorAll('.phase-container').forEach(container => {
                    updatePhaseStatus(container.id);
                });
            }
            
            // Apply the loaded offsets to the input fields
            applyOffsetValuesToInputs();
        }

        function exportProject() {
            const formData = getFormData();
            
            // Validate required fields
            if (!formData.projectDetails.bookTitle || !formData.projectDetails.authorName) {
                alert('Please enter at least the Book Title and Author Name before exporting.');
                return;
            }
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(formData, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", 
                `${formData.projectDetails.bookTitle.replace(/[^a-z0-9]/gi, '_').toLowerCase()}-export.json`);
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        // Toggle phase collapse
        window.togglePhase = function(phaseId) {
            const phaseContainer = document.getElementById(phaseId);
            phaseContainer.classList.toggle('collapsed');
        };
    </script>
</body>
</html>
