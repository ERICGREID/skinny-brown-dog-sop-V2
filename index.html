<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publishing Workflow</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .task-item { margin: 8px 0; }
        .due-date { font-size: 0.9em; color: #666; margin-left: 15px; font-style: italic; }
        button { margin: 10px 5px 0 0; padding: 8px 12px; }
    </style>
</head>
<body>
    <h1>Publishing Workflow</h1>

    <label for="startDate">Project Start Date:</label>
    <input type="date" id="startDate">

    <h2>Tasks</h2>
    <ul>
        <li class="task-item">
            <input type="checkbox" id="task1">
            <label for="task1">Schedule call</label>
        </li>
        <li class="task-item">
            <input type="checkbox" id="task2">
            <label for="task2">Send welcome pack</label>
        </li>
        <li class="task-item">
            <input type="checkbox" id="task3">
            <label for="task3">Receive agreement</label>
        </li>
        <li class="task-item">
            <input type="checkbox" id="task4">
            <label for="task4">First payment</label>
        </li>
        <li class="task-item">
            <input type="checkbox" id="task5">
            <label for="task5">Create Google Drive folder</label>
        </li>
        <!-- Add more tasks as needed -->
    </ul>

    <button id="saveBtn">Save Project</button>
    <button id="exportBtn">Export JSON</button>

    <!-- Google API -->
    <script src="https://apis.google.com/js/api.js"></script>

    <script>
        // Task-offsets configuration
        const taskDueDateOffsets = {
            task1: 2,
            task2: 3,
            task3: 7,
            task4: 1,
            task5: 2,
            // Extend with more task offsets...
        };

        // Date utilities
        function addDays(date, days) {
            const result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        }
        function formatDate(date) {
            return date.toLocaleDateString('en-US', {
                year: 'numeric', month: 'short', day: 'numeric'
            });
        }

        // Calculate and display due dates
        function calculateAndDisplayDueDates() {
            const startInput = document.getElementById('startDate');
            const startDate = new Date(startInput.value);
            if (isNaN(startDate)) return;

            document.querySelectorAll('.task-item').forEach(item => {
                if (!item.querySelector('.due-date')) {
                    const span = document.createElement('span');
                    span.className = 'due-date';
                    item.appendChild(span);
                }
            });

            Object.entries(taskDueDateOffsets).forEach(([id, offset]) => {
                const cb = document.getElementById(id);
                if (cb) {
                    const due = addDays(startDate, offset);
                    const span = cb.closest('.task-item').querySelector('.due-date');
                    span.textContent = `Due: ${formatDate(due)}`;
                    cb.dataset.dueDate = due.toISOString();
                }
            });
        }

        // Export project data
        function getFormData() {
            const data = { taskDueDates: {} };
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                if (cb.dataset.dueDate) {
                    data.taskDueDates[cb.id] = {
                        dueDate: cb.dataset.dueDate,
                        completed: cb.checked,
                        completionDate: cb.dataset.completionDate || null
                    };
                }
            });
            return data;
        }
        function exportProject() {
            const json = JSON.stringify(getFormData());
            const link = document.createElement('a');
            link.href = 'data:text/json;charset=utf-8,' + encodeURIComponent(json);
            link.download = 'project-export.json';
            document.body.appendChild(link);
            link.click();
            link.remove();
        }

        // Save to Google Drive
        function saveCurrentProject() {
            const formData = getFormData();
            if (window.gapi && gapi.client) {
                gapi.client.drive.files.create({
                    resource: {
                        name: `WorkflowBackup_${Date.now()}.json`,
                        mimeType: 'application/json'
                    },
                    media: { mimeType: 'application/json', body: JSON.stringify(formData) }
                }).then(res => console.log('Drive backup:', res));
            }
        }

        // Initialize behaviors
        document.addEventListener('DOMContentLoaded', () => {
            const startDate = document.getElementById('startDate');
            startDate.addEventListener('change', calculateAndDisplayDueDates);
            calculateAndDisplayDueDates();

            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.addEventListener('change', () => {
                    if (cb.checked && !cb.dataset.completionDate) {
                        cb.dataset.completionDate = new Date().toISOString();
                    }
                });
            });

            document.getElementById('exportBtn').addEventListener('click', exportProject);
            document.getElementById('saveBtn').addEventListener('click', saveCurrentProject);
        });
    </script>
</body>
</html>
