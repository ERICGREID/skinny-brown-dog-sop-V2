<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Publishing Workflow Tracker</title>
    <style>
        /* [Previous CSS remains unchanged] */
        
        /* Add these new styles */
        .due-date {
            font-size: 0.9em;
            color: var(--gray-600);
            margin-left: 15px;
            font-style: italic;
        }
        
        .completion-date {
            font-size: 0.9em;
            color: var(--success);
            margin-left: 10px;
        }
        
        .date-controls {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- [Previous HTML structure remains unchanged until task lists] -->
        
        <!-- Modified Task Item Example -->
        <ul class="task-list">
            <li class="task-item">
                <input type="checkbox" id="task1" name="task1">
                <label for="task1">Schedule discovery call</label>
                <span class="due-date"></span>
                <span class="completion-date"></span>
                <div class="date-controls">
                    <small>Days after start: <input type="number" class="days-offset" value="2" min="0" style="width: 40px;"></small>
                </div>
            </li>
            <!-- [Repeat for all tasks] -->
        </ul>
        
        <!-- [Rest of original HTML] -->
    </div>

    <script>
        // Task Configuration
        const defaultTaskOffsets = {
            task1: 2, task2: 3, task3: 7, task4: 1, task5: 2,
            task6: 2, task7: 3, task8: 3, task9: 5
            // [Add all other tasks]
        };
        
        let taskDueDateOffsets = {...defaultTaskOffsets};

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            loadOffsetsFromStorage();
            setupEventListeners();
        });

        function loadOffsetsFromStorage() {
            const savedOffsets = localStorage.getItem('taskDueDateOffsets');
            if (savedOffsets) {
                taskDueDateOffsets = {...defaultTaskOffsets, ...JSON.parse(savedOffsets)};
            }
            applyOffsetValuesToInputs();
        }

        function applyOffsetValuesToInputs() {
            document.querySelectorAll('.days-offset').forEach(input => {
                const taskId = input.closest('.task-item').querySelector('input[type="checkbox"]').id;
                input.value = taskDueDateOffsets[taskId] || 0;
            });
        }

        function setupEventListeners() {
            // Update due dates when start date changes
            document.getElementById('startDate').addEventListener('change', calculateAllDueDates);
            
            // Save offset changes
            document.querySelectorAll('.days-offset').forEach(input => {
                input.addEventListener('change', function() {
                    const taskId = this.closest('.task-item').querySelector('input[type="checkbox"]').id;
                    taskDueDateOffsets[taskId] = parseInt(this.value) || 0;
                    localStorage.setItem('taskDueDateOffsets', JSON.stringify(taskDueDateOffsets));
                    calculateAllDueDates();
                });
            });
            
            // Track completion dates
            document.querySelectorAll('.task-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const completionSpan = this.closest('.task-item').querySelector('.completion-date');
                    if (this.checked) {
                        completionSpan.textContent = `Completed: ${new Date().toLocaleDateString()}`;
                        this.dataset.completionDate = new Date().toISOString();
                    } else {
                        completionSpan.textContent = '';
                        delete this.dataset.completionDate;
                    }
                });
            });
        }

        function calculateAllDueDates() {
            const startDate = new Date(document.getElementById('startDate').value);
            if (isNaN(startDate.getTime())) return;

            document.querySelectorAll('.task-item').forEach(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                const dueDateSpan = item.querySelector('.due-date');
                const daysOffset = taskDueDateOffsets[checkbox.id] || 0;
                
                const dueDate = new Date(startDate);
                dueDate.setDate(dueDate.getDate() + daysOffset);
                
                dueDateSpan.textContent = `Due: ${dueDate.toLocaleDateString()}`;
                checkbox.dataset.dueDate = dueDate.toISOString();
            });
        }

        // [Previous save/load/export functions remain unchanged]
        // Add due dates to exported data
        function getFormData() {
            const formData = {
                // ... existing data ...
                taskDueDates: {}
            };

            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                formData.taskDueDates[checkbox.id] = {
                    dueDate: checkbox.dataset.dueDate,
                    completed: checkbox.checked,
                    completionDate: checkbox.dataset.completionDate || null,
                    daysOffset: taskDueDateOffsets[checkbox.id] || 0
                };
            });

            return formData;
        }
    </script>
</body>
</html>
